# ğŸ« IT Helpdesk Ticket Management System
### Built with SAP Cloud Application Programming Model (CAP) + Node.js + SQLite

IT Helpdesk application that manages support tickets, agents, and SLAs using SAP CAP framework.

---

## ğŸ“‹ Features

- âœ… Create & manage support tickets with auto-generated ticket numbers (`TKT-2024-00001`)
- âœ… Track ticket lifecycle: `OPEN â†’ IN_PROGRESS â†’ RESOLVED â†’ CLOSED`
- âœ… Priority levels: `LOW | MEDIUM | HIGH | CRITICAL`
- âœ… Automatic SLA due-date calculation based on category
- âœ… Assign agents, escalate, resolve, close and reopen tickets
- âœ… Comments system (public & internal notes)
- âœ… Full audit trail for every action
- âœ… Dashboard statistics
- âœ… Overdue ticket detection

---

## ğŸ§± Tech Stack

| Layer | Technology |
|---|---|
| **Backend Framework** | SAP CAP (Cloud Application Programming Model) |
| **Runtime** | Node.js |
| **Database (local)** | SQLite (via `@cap-js/sqlite`) |
| **API** | OData V4 (auto-generated by CAP) |
| **Testing** | Jest + Supertest |

---

## ğŸ—ï¸ Project Structure

```
helpdesk-cap/
â”œâ”€â”€ ğŸ“ db/
â”‚   â”œâ”€â”€ schema.cds              â† Data model (entities, types, enums)
â”‚   â””â”€â”€ data/                   â† CSV seed data for local dev
â”‚       â”œâ”€â”€ helpdesk-Categories.csv
â”‚       â”œâ”€â”€ helpdesk-Departments.csv
â”‚       â”œâ”€â”€ helpdesk-Agents.csv
â”‚       â”œâ”€â”€ helpdesk-Employees.csv
â”‚       â””â”€â”€ helpdesk-Tickets.csv
â”œâ”€â”€ ğŸ“ srv/
â”‚   â”œâ”€â”€ helpdesk-service.cds    â† Service definition (OData endpoints + actions)
â”‚   â””â”€â”€ helpdesk-service.js     â† Business logic handlers (Node.js)
â”œâ”€â”€ ğŸ“ test/
â”‚   â””â”€â”€ helpdesk.test.js        â† Jest test suite
â”œâ”€â”€ package.json
â”œâ”€â”€ .cdsrc.json
â””â”€â”€ README.md
```

---

## ğŸš€ Getting Started

### Prerequisites
- Node.js 20+ 
- npm 9+

### 1. Clone the repo
```bash
git clone https://github.com/RameshPrabakar/sap-btp-helpdesk-cap.git
cd helpdesk-cap
```

### 2. Install dependencies
```bash
npm install
```

### 3. Run locally with hot reload
```bash
npm run dev
```

The API is now live at: **http://localhost:4004**

### 4. Explore the API

Open your browser and visit:
```
http://localhost:4004
```

You'll see all available endpoints:
- `/helpdesk` â†’ Main helpdesk service
- `/admin` â†’ Admin management service

---

## ğŸ“¡ API Reference

### OData Endpoints (Auto-generated)

| Method | Endpoint | Description |
|---|---|---|
| `GET` | `/helpdesk/Tickets` | List all tickets |
| `POST` | `/helpdesk/Tickets` | Create new ticket |
| `GET` | `/helpdesk/Tickets(:ID)` | Get single ticket |
| `PATCH` | `/helpdesk/Tickets(:ID)` | Update ticket |
| `GET` | `/helpdesk/Agents` | List active agents |
| `GET` | `/helpdesk/Categories` | List categories |
| `GET` | `/helpdesk/AuditLogs` | View audit trail |

### Custom Actions

| Method | Endpoint | Body | Description |
|---|---|---|---|
| `POST` | `/helpdesk/assignAgent` | `{ticketID, agentID, remarks}` | Assign agent to ticket |
| `POST` | `/helpdesk/resolveTicket` | `{ticketID, resolutionNote, agentName}` | Mark ticket as resolved |
| `POST` | `/helpdesk/closeTicket` | `{ticketID, agentName}` | Close a resolved ticket |
| `POST` | `/helpdesk/escalateTicket` | `{ticketID, reason, agentName}` | Escalate ticket priority |
| `POST` | `/helpdesk/reopenTicket` | `{ticketID, reason, agentName}` | Reopen resolved/closed ticket |
| `POST` | `/helpdesk/changePriority` | `{ticketID, priority, reason}` | Change priority |

### Custom Functions

| Method | Endpoint | Description |
|---|---|---|
| `GET` | `/helpdesk/getDashboardStats()` | Get ticket statistics |
| `GET` | `/helpdesk/getOverdueTickets()` | List overdue tickets |
| `GET` | `/helpdesk/getAgentTickets(agentID='...')` | Tickets assigned to an agent |

---

## ğŸ’¡ Example API Calls

### Create a Ticket
```bash
curl -X POST http://localhost:4004/helpdesk/Tickets \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Cannot connect to company WiFi",
    "description": "My laptop stopped detecting the office WiFi network after the latest Windows update",
    "priority": "HIGH",
    "category_ID": "cat-0003",
    "department_ID": "dept-0001",
    "reporter_ID": "emp-0001"
  }'
```

### Assign an Agent
```bash
curl -X POST http://localhost:4004/helpdesk/assignAgent \
  -H "Content-Type: application/json" \
  -d '{
    "ticketID": "<ticket-uuid>",
    "agentID": "agt-0003",
    "remarks": "Assigning to L2 support for network issues"
  }'
```

### Resolve a Ticket
```bash
curl -X POST http://localhost:4004/helpdesk/resolveTicket \
  -H "Content-Type: application/json" \
  -d '{
    "ticketID": "<ticket-uuid>",
    "resolutionNote": "WiFi issue fixed by rolling back the Windows network driver update",
    "agentName": "Mike Chen"
  }'
```

### Get Dashboard Stats
```bash
curl http://localhost:4004/helpdesk/getDashboardStats()
```

### Filter Open Critical Tickets
```bash
curl "http://localhost:4004/helpdesk/Tickets?\$filter=status eq 'OPEN' and priority eq 'CRITICAL'"
```

---

## ğŸ§ª Running Tests

```bash
npm test
```

Tests cover:
- Ticket creation validation
- OData queries & filters
- Assign agent action
- Resolve & close lifecycle
- Escalation logic
- Dashboard statistics
- Comment creation

---

## ğŸ“Š Data Model Overview

```
Departments â”€â”€< Employees â”€â”€< Tickets >â”€â”€ Agents
                                â”‚
                            Categories
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 Comments              AuditLogs
                 Attachments
```

---

## ğŸ—ºï¸ Roadmap (Future Improvements)

- [ ] Add React frontend with SAP UI5 Web Components
- [ ] Email notifications on ticket assignment/resolution
- [ ] SAP HANA Cloud support for production deployment
- [ ] Role-based access control (RBAC)
- [ ] File attachment upload support
- [ ] SLA breach alerts
- [ ] Deploy to SAP BTP Cloud Foundry

---

## ğŸ“š Learning Resources

- [SAP CAP Official Documentation](https://cap.cloud.sap/docs)
- [SAP BTP Developer Tutorials](https://developers.sap.com/tutorial-navigator.html)
- [SAP Learning Portal - CAP Course](https://learning.sap.com)

---

## ğŸ“„ License

MIT License â€” feel free to use this project for learning and practice.